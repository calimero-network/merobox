description: Single node workflow - basic operations without multi-node sync
name: Single Node Workflow

nodes:
  chain_id: testnet-1
  count: 1
  image: ghcr.io/calimero-network/merod:edge
  prefix: calimero-node

steps:
  # Step 1: Install the application
  - name: Install Application
    type: install_application
    node: calimero-node-1
    path: workflow-examples/res/kv_store.wasm
    dev: true
    outputs:
      app_id: applicationId

  # Step 2: Create a context
  - name: Create Context
    type: create_context
    node: calimero-node-1
    application_id: "{{app_id}}"
    outputs:
      context_id: contextId
      member_public_key: memberPublicKey

  # Step 3: Wait for context creation
  - name: Wait for Context
    type: wait
    seconds: 2

  # Step 4: Set a key-value pair
  - name: Set Key-Value
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: set
    args:
      key: hello
      value: world
    outputs:
      set_result: result

  # Step 5: Wait for operation
  - name: Wait for Set
    type: wait
    seconds: 2

  # Step 6: Get the value back
  - name: Get Key-Value
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: get
    args:
      key: hello
    outputs:
      get_result: result

  # Step 7: Set another value
  - name: Set Another Key-Value
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: set
    args:
      key: test_key
      value: test_value
    outputs:
      set_result2: result

  # Step 8: Get the second value
  - name: Get Second Key-Value
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_public_key}}"
    method: get
    args:
      key: test_key
    outputs:
      get_result2: result

stop_all_nodes: false
restart: false
wait_timeout: 30

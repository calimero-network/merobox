description: Test workflow with different ports to avoid conflicts
name: Test Workflow

# Don't force pull to avoid unnecessary downloads
force_pull_image: false

nodes:
  test-workflow-1:
    chain_id: testnet-1
    image: ghcr.io/calimero-network/merod:edge
    # Use explicit ports to avoid conflicts with test fixtures
    port: 2440  # Different from fixture ports (2428, 2430)
    rpc_port: 2540  # Different from fixture ports (2528, 2530)

steps:
  - name: Wait for node to be ready
    type: wait
    seconds: 2  # Reduced wait time for faster execution
  
  # Add application installation step to test for bugs
  - name: Install Test Application
    type: install_application
    node: test-workflow-1
    path: ../workflow-examples/res/kv_store.wasm
    dev: true
    outputs:
      app_id: applicationId  # Capture the application ID for testing
  
  # Add context creation step to demonstrate dynamic variable capture
  - name: Create Test Context
    type: create_context
    node: test-workflow-1
    application_id: '{{app_id}}'  # Use the captured app_id from previous step
    outputs:
      context_id: contextId  # Capture the context ID
      member_public_key: memberPublicKey  # Capture the member public key

# Configuration options
stop_all_nodes: false  # Keep nodes running for reuse across tests
restart: false          # Don't restart nodes at the beginning of workflow
wait_timeout: 30        # Reduced timeout for faster execution
